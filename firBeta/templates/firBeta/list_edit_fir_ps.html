{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load templatetag_beta %}

{% block head %}
<style>
    .container {
        margin: 0 auto;
        max-width: 1280px;
        width: 90%;
    }

    .table-wrapper {
        overflow-x: auto;
        overflow-y: auto;
        height: 700px;
    }

    table.data-table {
        border-collapse: separate;
    }

    table.data-table > thead > tr.header-row-1 > th, table.data-table > thead > tr.header-row-2 > th {
        border: 2px black solid;
        border-left: 0px;
        border-radius: 0;
        z-index: 3;
    }

    tr.header-row-1 > th.header-element-1:nth-child(1) {
        border-left: 2px black solid;
        border-bottom-left-radius: 15px;
        border-top-left-radius: 15px;
    }

    tr.header-row-1 > th.header-element-1:last-child {
        /* border-top-right-radius: 15px;
        border-bottom-right-radius: 15px; */

        position: sticky !important;
        right: 0;
        z-index: 5;
    }
    tr.header-row-1 > th.header-element-1:nth-last-child(2) {
        /* border-top-right-radius: 15px;
        border-bottom-right-radius: 15px; */

        position: sticky !important;
        right: 132px;
        z-index: 5;

        border-left: 2px black solid;
    }
    /* tr.header-row-1 > th.header-element-1:nth-last-child(3) {

        position: sticky !important;
        right: 230px;
        z-index: 5;
        border-left: 2px black solid;
    } */

    table.data-table > tbody.data-table-body > tr.data-row > td {
        border: 1px gray solid;
        border-radius: 0;
    }

    tr.data-row > td:nth-child(1) {
        border-bottom-left-radius: 15px !important;
        border-top-left-radius: 15px !important;
    }

    tr.data-row > td:last-child {
        /* border-bottom-right-radius: 15px;
        border-top-right-radius: 15px; */

        position: sticky !important;
        right: 0;
        z-index: 4;
    }
    tr.data-row > td:nth-last-child(2) {
        /* border-bottom-right-radius: 15px;
        border-top-right-radius: 15px; */

        position: sticky !important;
        right: 131px;
        z-index: 4;

        border-left: 1px gray solid;
    }
    /* tr.data-row > td:nth-last-child(3) {
        position: sticky !important;
        right: 230.5px;
        z-index: 4;

        border-left: 1px gray solid;
    } */

    table.data-table > thead > tr.header-row-1 > th {
        position: sticky !important;
        top: 0;
    }

    table.data-table > thead > tr.header-row-2 > th {
        position: sticky !important;
        top: 77px;;
    }


    tr.header-row-1 > th.header-element-1:nth-child(even),
    tr.header-row-2 > th.header-element-2.sub-head-even {
        background-color: #0097a7 !important;
    }

    tr.header-row-1 > th.header-element-1:nth-child(odd),
    tr.header-row-2 > th.header-element-2.sub-head-odd {
        background-color: #00838f !important;
    }

    tr.blank-row > td {
        border: 0px;
        color: #e8f5e9;
        background-color: #e8f5e9;
    }

    input, textarea {
        text-transform: capitalize;
    }
    
    input:disabled, textarea:disabled {
        color: rgba(0, 0, 0, 0.87) !important;
    }
</style>
{% endblock head %}

{% comment %}
{% block content %}
<div class="container">
    <div class="section"></div>
    <div class="section">
        <div class="table-wrapper" data-fl-scrolls>
            <table class="centered responsive-table data-table">

                <!-- <colgroup>
                    <col span="1" style="background-color: antiquewhite; width: 80px;">
                    <col span="1" style="background-color: antiquewhite; width: 110px;">
                    <col span="2" style="background-color: antiquewhite; width: 100px;">
                    <col span="2" style="background-color: antiquewhite; width: 120px;">
                    <col span="1" style="background-color: antiquewhite; width: 100px;">
                    <col span="3" style="background-color: antiquewhite; width: 110px;">
                    <col span="1" style="background-color: antiquewhite; width: 100px;">
                    <col span="5" style="background-color: antiquewhite; width: 200px;">
                </colgroup> -->

                <thead>
                    <tr class="header-row-1">
                        <th class="header-element-1" rowspan="2">Sub Division<br>PS</th>
                        <th class="header-element-1" rowspan="2">FIR No.<br>Date</th>
                        <th class="header-element-1" rowspan="2">U/S</th>
                        <th class="header-element-1" rowspan="2">I/O Name</th>
                        <th class="header-element-1" rowspan="2">Accused Name</th>
                        <th class="header-element-1" rowspan="2">Accused Status</th>
                        <th class="header-element-1" rowspan="2">Limitation Period</th>
                        <th class="header-element-1" colspan="2">Current Status</th>
                        <th class="header-element-1" colspan="4">Approval Status at SSP Office</th>
                        <th class="header-element-1" rowspan="2">Received Back in PS Date</th>
                        <th class="header-element-1" rowspan="2">Put in Court Date</th>
                        <th class="header-element-1" colspan="3">Naib Court</th>
                        <th class="header-element-1" colspan="3">Re-investigation Details (PS)</th>
                        <th class="header-element-1" rowspan="2">Edit</th>
                        <th class="header-element-1" rowspan="2">Add</th>
                    </tr>
                    <tr class="header-row-2">
                        <th class="header-element-2 sub-head-even">Status</th>
                        <th class="header-element-2 sub-head-even">Date</th>
                        <th class="header-element-2 sub-head-odd">Received at VRK Branch Date</th>
                        <th class="header-element-2 sub-head-odd">Status</th>
                        <th class="header-element-2 sub-head-odd">Date</th>
                        <th class="header-element-2 sub-head-odd">Sent back to PS Date</th>
                        <th class="header-element-2 sub-head-even">Received by Naib Court Date</th>
                        <th class="header-element-2 sub-head-even">Status</th>
                        <th class="header-element-2 sub-head-even">Date</th>
                        <th class="header-element-2 sub-head-odd">Received Back on Date</th>
                        <th class="header-element-2 sub-head-odd">Marked to I/O Name</th>
                        <th class="header-element-2 sub-head-odd">Date</th>
                    </tr>
                </thead>

                <tbody>

                    <tr class="blank-row">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                    {% for fir_set in fir_list %}
                        {% for fir_phase in fir_set.1 %}
                            <tr class="cyan lighten-4 data-row">
                                        <td>{{ fir_set.0.sub_division }}<br>({{ fir_set.0.police_station }})</td>
                                        <td><strong>{{ fir_set.0.fir_no }}</strong><br>{{ fir_phase.date_registered|date:'d/m/y' }}</td>
                                        <td>{{ fir_phase.under_section }}</td>
                                        <td>{{ fir_phase.io_name }}</td>
                                        <td>{{ fir_phase.accused_name }}</td>
                                        <td>{{ fir_phase.accused_status }}</td>

                                        <td>
                                            {% if fir_phase.pk|is_last_phase %}
                                                {% if fir_phase.pk|will_expire_at == 0 %}
                                                    <span class="new badge red darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 1 %}
                                                    <span class="new badge orange darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 2 %}
                                                    <span class="new badge amber lighten-2 black-text" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 3 %}
                                                    {{ fir_phase.limitation_period }}
                                                {% endif %}
                                            {% else %}
                                                {{ fir_phase.limitation_period }} days
                                            {% endif %}
                                            <br>
                                            {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}
                                        </td>
                                        
                                        <td>{{ fir_phase.current_status }}</td>

                                        <td>
                                            {% if fir_phase.current_status_date %}
                                                {{ fir_phase.current_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_receival_date %}
                                                <td>{{ fir_phase.vrk_receival_date|date:'d/m/y' }}</td>
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status %}
                                                {{ fir_phase.vrk_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status_date %}
                                                {{ fir_phase.vrk_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_sent_back_date %}
                                                {{ fir_phase.vrk_sent_back_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.received_from_vrk_date %}
                                                {{ fir_phase.received_from_vrk_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>   
                                        <td>
                                            {% if fir_phase.put_in_court_date %}
                                                {{ fir_phase.put_in_court_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_receival_date %}
                                                {{ fir_phase.nc_receival_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>    
                                        <td>
                                            {% if fir_phase.nc_status %}
                                                {{ fir_phase.nc_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_status_date %}
                                                {{ fir_phase.nc_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.received_from_nc_date %}
                                                {{ fir_phase.received_from_nc_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>  
                                        <td>
                                            {% if fir_phase.appointed_io %}
                                                {{ fir_phase.appointed_io }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td> 
                                        <td>
                                            {% if fir_phase.appointed_io_date %}
                                                {{ fir_phase.appointed_io_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>                             
                                <td>
                                    <a href="#!" class="btn-floating btn waves-effect waves-light cyan darken-4">
                                        <i class="material-icons">edit</i>
                                    </a>
                                </td>
                                <td>
                                    <a href="#!" class="btn-floating btn waves-effect waves-light grey">
                                        <i class="material-icons">add</i>
                                    </a>
                                </td>
                            </tr>

                            {% if fir_phase.pk|is_last_phase %}
                                <tr class="blank-row">
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}
{% endcomment %}

{% block content %}


<div class="container">
    <div class="section">
        <button class="toggle-btn btn waves-effect waves-light">Toggle Sorting Order</button>
    </div>
    <div class="section">
        <div class="table-wrapper" data-fl-scrolls>
            <table class="centered responsive-table data-table">

                <!-- <colgroup>
                    <col span="9">
                    <col span="1" style="width: 200px !important;">
                </colgroup> -->

                <thead>
                    <tr class="header-row-1">
                        <th class="header-element-1" rowspan="2">S. No.</th>
                        <th class="header-element-1" rowspan="2">Sub Division<br>PS</th>
                        <th class="header-element-1" rowspan="2">FIR No.<br>Date</th>
                        <th class="header-element-1" rowspan="2">U/S</th>
                        <th class="header-element-1" rowspan="2">I/O Name</th>
                        <th class="header-element-1" rowspan="2">Accused Name</th>
                        <th class="header-element-1" rowspan="2">Accused Status</th>
                        <th class="header-element-1" rowspan="2">Challan to Court Period</th>
                        <th class="header-element-1" colspan="2">Current Status</th>
                        <th class="header-element-1" colspan="4">Approval Status at SSP Office</th>
                        <th class="header-element-1" colspan="2">Post SSP Approval Details (PS)</th>
                        <th class="header-element-1" colspan="4">Naib Court</th>
                        <th class="header-element-1" colspan="3">Re-investigation Details (PS)</th>
                        <th class="header-element-1" rowspan="2">Edit</th>
                        <th class="header-element-1" rowspan="2">Save</th>
                        {% comment %} <th class="header-element-1" rowspan="2">Add</th> {% endcomment %}
                    </tr>
                    <tr class="header-row-2">
                        <th class="header-element-2 sub-head-odd">Status</th>
                        <th class="header-element-2 sub-head-odd">Date</th>
                        <th class="header-element-2 sub-head-even">Received at VRK Branch Date</th>
                        <th class="header-element-2 sub-head-even">Status</th>
                        <th class="header-element-2 sub-head-even">Date</th>
                        <th class="header-element-2 sub-head-even">Sent back to PS Date</th>
                        <th class="header-element-2 sub-head-odd">Received Back in PS Date</th>
                        <th class="header-element-2 sub-head-odd">Put in Court Date</th>
                        <th class="header-element-2 sub-head-even">Received by Naib Court Date</th>
                        <th class="header-element-2 sub-head-even">Status</th>
                        <th class="header-element-2 sub-head-even">Date</th>
                        <th class="header-element-2 sub-head-even">Sent back to PS Date</th>
                        <th class="header-element-2 sub-head-odd">Received Back on Date</th>
                        <th class="header-element-2 sub-head-odd">Marked to I/O Name</th>
                        <th class="header-element-2 sub-head-odd">Date</th>
                    </tr>
                </thead>

                <!-- CONDITIONAL RENDER IS NOW NOT REQUIRED HENCE ELSE BLOCK FOR THE FOLLOWING CONDITION WILL NEVER WORK -->
                {% if asc == 0 or asc == 1 %}
                    <tbody class="data-table-body content-descending">
                        <tr class="blank-row">
                            <td>//////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>//////////////////////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>/////////////////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            {% comment %} <td>///////////////</td> {% endcomment %}
                        </tr>

                        <form method="POST">
                            {% csrf_token %}
                            {% for fir_set in fir_list %}
                                {% for fir_phase in fir_set.1 %}
                                    <tr class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} data-row fir_{{fir_set.0.pk}} fir_phase_{{fir_phase.pk}}" data-tr-fir-phase="fir_phase_{{fir_phase.pk}}">
                                        <td><strong>{{forloop.parentloop.counter0|add:pagination_object.start_index}}.{{forloop.counter}}</strong></td>
                                        <td>{{ fir_set.0.sub_division }}<br>({{ fir_set.0.police_station }})</td>
                                        <td><strong>{{ fir_set.0.fir_no }}</strong><br>{{ fir_phase.date_registered|date:'d/m/y' }}</td>
                                        {% comment %} <td>{{ fir_phase.under_section }}</td> {% endcomment %}
                                        
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} under_section essential-close validate" disabled value="{{ fir_phase.under_section}}" placeholder="Enter U/S">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} io_name essential-close validate" disabled value="{{ fir_phase.io_name}}" placeholder="Enter name">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <textarea class="ps-editable-fields fir_phase_{{fir_phase.pk}} accused_name essential-close validate materialize-textarea" disabled>{{ fir_phase.accused_name }}</textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <textarea class="ps-editable-fields fir_phase_{{fir_phase.pk}} accused_status essential-close validate materialize-textarea" disabled>{{ fir_phase.accused_status }}</textarea>
                                            </div>
                                        </td>

                                        <td>
                                            {% comment %} {% if fir_phase.pk|is_last_phase %}
                                                {% if fir_phase.pk|will_expire_at == 0 %}
                                                    <span class="new badge red darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 1 %}
                                                    <span class="new badge orange darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 2 %}
                                                    <span class="new badge amber lighten-2 black-text" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 3 %}
                                                    {{ fir_phase.limitation_period }} days
                                                {% endif %}
                                            {% else %}
                                                {{ fir_phase.limitation_period }} days
                                            {% endif %} 
                                            {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} {% endcomment %}
                                            <div class="input-field">
                                                <input type="number" class="ps-editable-fields fir_phase_{{fir_phase.pk}} limitation_period essential-close validate" value="{{ fir_phase.limitation_period }}" disabled></input>
                                            </div>
                                            {% if fir_phase.pk|is_last_phase %}
                                                {% if fir_phase.pk|will_expire_at == 0 %}
                                                    <span class="new badge red darken-3" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 1 %}
                                                    <span class="new badge orange darken-3" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 2 %}
                                                    <span class="new badge amber lighten-2 black-text" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 3 %}
                                                    {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} 
                                                {% endif %}
                                            {% else %}
                                                {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} 
                                            {% endif %}
                                        </td>
                                        
                                        <td>
                                            <div class="input-field">
                                                <select class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status essential-close validate" disabled>
                                                    {% if fir_phase.current_status %}
                                                        {% if fir_phase.current_status == "Under Investigation" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation" selected>Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Challan Filed" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed" selected>Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Untraced" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced" selected>Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Cancelled" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled" selected>Cancelled</option>
                                                        {% endif %}
                                                    {% else %}
                                                        <option class="current-status-default-option" value="" disabled selected>-----------------</option>
                                                        <option value="Under Investigation">Under Investigation</option>
                                                        <option value="Challan Filed">Challan Filed</option>
                                                        <option value="Untraced">Untraced</option>
                                                        <option value="Cancelled">Cancelled</option>
                                                    {% endif %}
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                {% if fir_phase.current_status == "Under Investigation" %}
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status_date essential-close validate datepicker" disabled value="XXXXXXX" placeholder="Fill Date">
                                                {% else %}
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status_date essential-close validate datepicker" disabled value="{{ fir_phase.current_status_date|date:'d/m/y' }}" placeholder="Fill Date">
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_receival_date %}
                                                {{ fir_phase.vrk_receival_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status %}
                                                {{ fir_phase.vrk_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status_date %}
                                                {{ fir_phase.vrk_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_sent_back_date %}
                                                {{ fir_phase.vrk_sent_back_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} received_from_vrk_date validate datepicker" disabled value="{{ fir_phase.received_from_vrk_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} put_in_court_date validate datepicker" disabled value="{{ fir_phase.put_in_court_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_receival_date %}
                                                {{ fir_phase.nc_receival_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>    
                                        <td>
                                            {% if fir_phase.nc_status %}
                                                {{ fir_phase.nc_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_status_date %}
                                                {{ fir_phase.nc_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_sent_back_date %}
                                                {{ fir_phase.nc_sent_back_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} received_from_nc_date validate datepicker" disabled value="{{ fir_phase.received_from_nc_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td> 
                                        <td>
                                            {% if fir_phase.appointed_io %}
                                                <div class="input-field">
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io validate" disabled value="{{ fir_phase.appointed_io }}" placeholder="Enter name">
                                                </div>
                                            {% else %}
                                                <div class="input-field">
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io validate" disabled placeholder="Enter name">
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io_date validate datepicker" disabled value="{{ fir_phase.appointed_io_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>    
                                        
                                        {% if fir_phase.pk|is_last_phase %}
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                <a href="#!" class="ps-edit-btn btn waves-effect waves-light cyan darken-4" id="edit_fir_phase_{{fir_phase.pk}}">
                                                    Edit
                                                </a>
                                            </td>

                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                <a href="#!" class="ps-save-btn btn waves-effect waves-light cyan darken-4 disabled" id="save_fir_phase_{{fir_phase.pk}}">
                                                    Save
                                                </a>
                                                <br><br>
                                                {% if fir_phase.current_status == 'Challan Filed' %}
                                                    <a class="ps-save-close-btn btn waves-effect waves-light red darken-4 modal-trigger"  href="#close-confirmation-fir_phase_{{fir_phase.pk}}" id="save_close_fir_phase_{{fir_phase.pk}}">
                                                        Save&Close
                                                    </a>
                                                {% else %}
                                                    <a class="ps-save-close-btn btn waves-effect waves-light red darken-4 modal-trigger disabled"  href="#close-confirmation-fir_phase_{{fir_phase.pk}}" id="save_close_fir_phase_{{fir_phase.pk}}">
                                                        Save&Close
                                                    </a>
                                                {% endif %}
                                            </td>
                                            {% comment %}                                             
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                {% if  fir_phase.pk|is_third_phase %}
                                                    <i class="material-icons">remove</i>
                                                {% else %}
                                                    {% if fir_phase.pk|all_fields_filled %}
                                                        <a href="{% url 'firBeta:add_new_phase_fir' pk=fir_phase.pk %}" class="ps-add-phase-btn btn waves-effect waves-light cyan darken-4" id="add_fir_phase_{{fir_phase.pk}}">
                                                            ADD
                                                        </a>
                                                    {% else %}
                                                        <a href="{% url 'firBeta:add_new_phase_fir' pk=fir_phase.pk %}" class="ps-add-phase-btn btn waves-effect waves-light cyan darken-4 disabled" id="add_fir_phase_{{fir_phase.pk}}">
                                                            ADD
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                             {% endcomment %}
                                        {% else %}
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td>
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td>
                                            {% comment %} <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td> {% endcomment %}
                                        {% endif %}
                                    </tr>

                                    {% if fir_phase.pk|is_last_phase %}
                                        <tr class="blank-row fir_{{fir_set.0.pk}}">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            {% comment %} <td></td> {% endcomment %}
                                        </tr>
                                    {% endif %}

                                    <!-- Modal Structure -->
                                    <div id="close-confirmation-fir_phase_{{fir_phase.pk}}" class="modal">
                                        <div class="modal-content">
                                            <h4>Close FIR?</h4>
                                            <p>Are you sure you want to close this FIR? It cannot be opened again.</p>
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" id="close-confirmation-modal-btn-fir_phase_{{fir_phase.pk}}" class="modal-close close-confirmation-modal-btn fir_{{fir_set.0.pk}} waves-effect waves-red red darken-3 white-text btn-flat">Close FIR</a>
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </form>
                    </tbody>
                {% else %}
                    <tbody class="data-table-body content-ascending">
                        <tr class="blank-row">
                            <td>//////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>//////////////////////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>/////////////////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            <td>///////////////</td>
                            {% comment %} <td>///////////////</td> {% endcomment %}
                        </tr>

                        <form method="POST">
                            {% csrf_token %}
                            {% for fir_set in fir_list reversed %}
                                {% for fir_phase in fir_set.1 %}
                                    <tr class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} data-row fir_{{fir_set.0.pk}} fir_phase_{{fir_phase.pk}}" data-tr-fir-phase="fir_phase_{{fir_phase.pk}}">
                                        <td><strong>{{forloop.parentloop.counter0|add:pagination_object.start_index}}.{{forloop.counter}}</strong></td>
                                        <td>{{ fir_set.0.sub_division }}<br>({{ fir_set.0.police_station }})</td>
                                        <td><strong>{{ fir_set.0.fir_no }}</strong><br>{{ fir_phase.date_registered|date:'d/m/y' }}</td>
                                        {% comment %} <td>{{ fir_phase.under_section }}</td> {% endcomment %}
                                        
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} under_section essential-close validate" disabled value="{{ fir_phase.under_section}}" placeholder="Enter U/S">
                                            </div>
                                        </td>
                                        
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} io_name essential-close validate" disabled value="{{ fir_phase.io_name}}" placeholder="Enter name">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <textarea class="ps-editable-fields fir_phase_{{fir_phase.pk}} accused_name essential-close validate materialize-textarea" disabled>{{ fir_phase.accused_name }}</textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <textarea class="ps-editable-fields fir_phase_{{fir_phase.pk}} accused_status essential-close validate materialize-textarea" disabled>{{ fir_phase.accused_status }}</textarea>
                                            </div>
                                        </td>

                                        <td>
                                            {% comment %} {% if fir_phase.pk|is_last_phase %}
                                                {% if fir_phase.pk|will_expire_at == 0 %}
                                                    <span class="new badge red darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 1 %}
                                                    <span class="new badge orange darken-3" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 2 %}
                                                    <span class="new badge amber lighten-2 black-text" data-badge-caption="days">{{ fir_phase.limitation_period }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 3 %}
                                                    {{ fir_phase.limitation_period }} days
                                                {% endif %}
                                            {% else %}
                                                {{ fir_phase.limitation_period }} days
                                            {% endif %}
                                            <br>
                                            {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} {% endcomment %}
                                            <div class="input-field">
                                                <input type="number" class="ps-editable-fields fir_phase_{{fir_phase.pk}} limitation_period essential-close validate" value="{{ fir_phase.limitation_period }}" disabled></input>
                                            </div>
                                            {% if fir_phase.pk|is_last_phase %}
                                                {% if fir_phase.pk|will_expire_at == 0 %}
                                                    <span class="new badge red darken-3" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 1 %}
                                                    <span class="new badge orange darken-3" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 2 %}
                                                    <span class="new badge amber lighten-2 black-text" data-badge-caption="">{{ fir_phase.pk|get_expiry_date|date:'d/m/y' }}</span>
                                                {% elif fir_phase.pk|will_expire_at == 3 %}
                                                    {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} 
                                                {% endif %}
                                            {% else %}
                                                {{ fir_phase.pk|get_expiry_date|date:'d/m/y' }} 
                                            {% endif %}
                                        </td>
                                        
                                        <td>
                                            <div class="input-field">
                                                <select class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status essential-close validate" disabled>
                                                    {% if fir_phase.current_status %}
                                                        {% if fir_phase.current_status == "Under Investigation" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation" selected>Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Challan Filed" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed" selected>Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Untraced" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced" selected>Untraced</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        {% elif fir_phase.current_status == "Cancelled" %}
                                                            <option class="current-status-default-option" value="" disabled>-----------------</option>
                                                            <option value="Under Investigation">Under Investigation</option>
                                                            <option value="Challan Filed">Challan Filed</option>
                                                            <option value="Untraced">Untraced</option>
                                                            <option value="Cancelled" selected>Cancelled</option>
                                                        {% endif %}
                                                    {% else %}
                                                        <option class="current-status-default-option" value="" disabled selected>-----------------</option>
                                                        <option value="Under Investigation">Under Investigation</option>
                                                        <option value="Challan Filed">Challan Filed</option>
                                                        <option value="Untraced">Untraced</option>
                                                        <option value="Cancelled">Cancelled</option>
                                                    {% endif %}
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                {% if fir_phase.current_status == "Under Investigation" %}
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status_date essential-close validate datepicker" disabled value="XXXXXXX" placeholder="Fill Date">
                                                {% else %}
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} current_status_date essential-close validate datepicker" disabled value="{{ fir_phase.current_status_date|date:'d/m/y' }}" placeholder="Fill Date">
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_receival_date %}
                                                {{ fir_phase.vrk_receival_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status %}
                                                {{ fir_phase.vrk_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_status_date %}
                                                {{ fir_phase.vrk_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.vrk_sent_back_date %}
                                                {{ fir_phase.vrk_sent_back_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} received_from_vrk_date validate datepicker" disabled value="{{ fir_phase.received_from_vrk_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} put_in_court_date validate datepicker" disabled value="{{ fir_phase.put_in_court_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_receival_date %}
                                                {{ fir_phase.nc_receival_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>    
                                        <td>
                                            {% if fir_phase.nc_status %}
                                                {{ fir_phase.nc_status }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_status_date %}
                                                {{ fir_phase.nc_status_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if fir_phase.nc_sent_back_date %}
                                                {{ fir_phase.nc_sent_back_date|date:'d/m/y' }}
                                            {% else %}
                                                <i class="material-icons">remove</i>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} received_from_nc_date validate datepicker" disabled value="{{ fir_phase.received_from_nc_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td> 
                                        <td>
                                            {% if fir_phase.appointed_io %}
                                                <div class="input-field">
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io validate" disabled value="{{ fir_phase.appointed_io }}" placeholder="Enter name">
                                                </div>
                                            {% else %}
                                                <div class="input-field">
                                                    <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io validate" disabled placeholder="Enter name">
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="input-field">
                                                <input type="text" class="ps-editable-fields fir_phase_{{fir_phase.pk}} appointed_io_date validate datepicker" disabled value="{{ fir_phase.appointed_io_date|date:'d/m/y' }}" placeholder="Fill Date">
                                            </div>
                                        </td>    
                                        
                                        {% if fir_phase.pk|is_last_phase %}
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                <a href="#!" class="ps-edit-btn btn waves-effect waves-light cyan darken-4" id="edit_fir_phase_{{fir_phase.pk}}">
                                                    Edit
                                                </a>
                                            </td>

                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                <a href="#!" class="ps-save-btn btn waves-effect waves-light cyan darken-4 disabled" id="save_fir_phase_{{fir_phase.pk}}">
                                                    Save
                                                </a>
                                                <br><br>
                                                {% if fir_phase.current_status == 'Challan Filed' %}
                                                    <a class="ps-save-close-btn btn waves-effect waves-light red darken-4 modal-trigger"  href="#close-confirmation-fir_phase_{{fir_phase.pk}}" id="save_close_fir_phase_{{fir_phase.pk}}">
                                                        Save&Close
                                                    </a>
                                                {% else %}
                                                    <a class="ps-save-close-btn btn waves-effect waves-light red darken-4 modal-trigger disabled"  href="#close-confirmation-fir_phase_{{fir_phase.pk}}" id="save_close_fir_phase_{{fir_phase.pk}}">
                                                        Save&Close
                                                    </a>
                                                {% endif %}
                                            </td>
                                            {% comment %}
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column">
                                                {% if  fir_phase.pk|is_third_phase %}
                                                    <i class="material-icons">remove</i>
                                                {% else %}
                                                    {% if fir_phase.pk|all_fields_filled %}
                                                        <a href="{% url 'firBeta:add_new_phase_fir' pk=fir_phase.pk %}" class="ps-add-phase-btn btn waves-effect waves-light cyan darken-4" id="add_fir_phase_{{fir_phase.pk}}">
                                                            ADD
                                                        </a>
                                                    {% else %}
                                                        <a href="{% url 'firBeta:add_new_phase_fir' pk=fir_phase.pk %}" class="ps-add-phase-btn btn waves-effect waves-light cyan darken-4 disabled" id="add_fir_phase_{{fir_phase.pk}}">
                                                            ADD
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            {% endcomment %}
                                        {% else %}
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td>
                                            <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td>
                                            {% comment %} <td class="cyan lighten-{{fir_phase.phase_index|get_color_shade}} fir_phase_{{fir_phase.pk}} right-sticky-column"><i class="material-icons">remove</i></td> {% endcomment %}
                                        {% endif %}
                                    </tr>

                                    {% if fir_phase.pk|is_last_phase %}
                                        <tr class="blank-row fir_{{fir_set.0.pk}}">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            {% comment %} <td></td> {% endcomment %}
                                        </tr>
                                    {% endif %}

                                    <!-- Modal Structure -->
                                    <div id="close-confirmation-fir_phase_{{fir_phase.pk}}" class="modal">
                                        <div class="modal-content">
                                            <h4>Close FIR?</h4>
                                            <p>Are you sure you want to close this FIR? It cannot be opened again.</p>
                                        </div>
                                        <div class="modal-footer">
                                            <a href="#!" id="close-confirmation-modal-btn-fir_phase_{{fir_phase.pk}}" class="modal-close close-confirmation-modal-btn fir_{{fir_set.0.pk}} waves-effect waves-red red darken-3 white-text btn-flat">Close FIR</a>
                                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </form>
                    </tbody>
                {% endif %}
            </table>
        </div>

        <!-- PAGINATION CODE BEGINS -->
        {% include "firBeta/_pagination.html" %}
        <!-- PAGINATION CODE ENDS -->

    </div>
</div>
{% endblock content %}

{% block tail %}
<script>
    // Activating corresponding fields on clicking edit button
    $('.ps-edit-btn').click(function() {
        var fir_phase_pk = $(this).attr('id').substring(5); // removing the word 'edit'
        $(this).addClass("disabled");
        $(`.ps-editable-fields.${fir_phase_pk}`).each(function() {
            $(this).removeAttr("disabled", "disabled");
        })
        if($(`.current_status.${fir_phase_pk}`).val() == 'Under Investigation') {
            $(`.current_status_date.${fir_phase_pk}`).val('XXXXXXX');
            $(`.current_status_date.${fir_phase_pk}`).attr('disabled','disabled');
        }
        $(`.data-row.${fir_phase_pk}`).removeClass('cyan');
        $(`.data-row.${fir_phase_pk}`).removeClass('blue');
        $(`.data-row.${fir_phase_pk}`).addClass('teal');

        $(`.right-sticky-column.${fir_phase_pk}`).each(function() {
            $(this).removeClass('cyan');
            $(this).removeClass('blue');
            $(this).addClass('teal');
        })

        $('select').formSelect();
    })

    $('.ps-editable-fields').change(function() {
        var fir_phase_pk = $(this).attr('class').split(' ')[1]; // fir_phase_{{fir_phase.pk}} is the second class allotted to every editable field
        $(`#save_${fir_phase_pk}`).removeClass('disabled');
        $(`#add_${fir_phase_pk}`).addClass('disabled');

        if ($(this).hasClass('current_status')) {
            if($(this).val() == 'Under Investigation') {
                $(`.current_status_date.${fir_phase_pk}`).val('XXXXXXX');
                $(`.current_status_date.${fir_phase_pk}`).attr('disabled','disabled');
            } else {
                $(`.current_status_date.${fir_phase_pk}`).val('');
                $(`.current_status_date.${fir_phase_pk}`).removeAttr('disabled','disabled');
            }
        }

        var isFilled = true;
        $(`.essential-close.${fir_phase_pk}`).each(function() {
            if ($(this).val() === '') {
                isFilled = false;
            }
        })
        if ((isFilled === true) && ($(`.current_status.${fir_phase_pk}`).val() === 'Challan Filed')) {
            $(`#save_close_${fir_phase_pk}`).removeClass("disabled");
        } else {
            $(`#save_close_${fir_phase_pk}`).addClass("disabled");
        }
    })

    $('.ps-save-btn').click(function () {
        var fir_phase_id = $(this).attr('id').substring(5);
        var fir_phase_pk = $(this).attr('id').substring(15);

        $(this).text("Wait..")

        $.ajax({
            type: 'POST',
            url: '/firBeta/ajax/edit_fir_save_ps/',
            headers: {
                'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
            },
            data: {
                phase_pk: fir_phase_pk,
                under_section: $(`.under_section.${fir_phase_id}`).val(),
                io_name: $(`.io_name.${fir_phase_id}`).val(),
                accused_name: $(`.accused_name.${fir_phase_id}`).val(),
                accused_status: $(`.accused_status.${fir_phase_id}`).val(),
                limitation_period: $(`.limitation_period.${fir_phase_id}`).val(),
                current_status: $(`.current_status.${fir_phase_id}`).val(),
                current_status_date: $(`.current_status_date.${fir_phase_id}`).val(),
                received_from_vrk_date: $(`.received_from_vrk_date.${fir_phase_id}`).val(),
                put_in_court_date: $(`.put_in_court_date.${fir_phase_id}`).val(),
                received_from_nc_date: $(`.received_from_nc_date.${fir_phase_id}`).val(),
                appointed_io: $(`.appointed_io.${fir_phase_id}`).val(),
                appointed_io_date: $(`.appointed_io_date.${fir_phase_id}`).val(),              
            },
            success: function (data) {
                $(`#save_${fir_phase_id}`).text("SAVE");
                if (data == 0) {
                    $(`#save_${fir_phase_id}`).addClass('disabled');
                    $(`#edit_${fir_phase_id}`).removeClass('disabled');
                    $(`.ps-editable-fields.${fir_phase_id}`).attr('disabled','disabled');
                    $(`.data-row.${fir_phase_id}`).removeClass('teal');
                    $(`.data-row.${fir_phase_id}`).removeClass('blue');
                    $(`.data-row.${fir_phase_id}`).addClass('cyan');
                    $(`.right-sticky-column.${fir_phase_id}`).each(function() {
                        $(this).removeClass('teal');
                        $(this).removeClass('blue');
                        $(this).addClass('cyan');
                    })
                    $('select').formSelect();
                    alert('FIR saved successfully!');
                } else if (data == 19) {
                    alert('FIR saved successfully!');
                    // window.location.href = '/firBeta/ps';
                } else if (data == 1) {
                    window.location.href = '/fault/Missing%20parameters%20for%registration';
                } else if (data == 2) {
                    window.location.href = '/fault/ACCESS%20DENIED!';
                } else if (data == 3) {
                    window.location.href = '/fault/Invalid%20Operation%20Requested';
                } else if (data == 4) {
                    alert('ERROR\nInvalid parameters passed, kindly recheck.' )
                } else if (data == 5) {
                    alert('ERROR\nMissing essential parameters' )
                } else if (data == 6) {
                    alert('ERROR\nMissing essential parameters' )
                } else if (data == 7) {
                    alert('ERROR\nFile cannot be received until it is returned from SSP Office' )
                } else if (data == 8) {
                    alert('ERROR\nFile cannot be submitted in Court before it is received back from SSP Office' )
                } else if (data == 9) {
                    alert('ERROR\nFile cannot be received until it is returned from Naib Court' )
                } else if (data == 10) {
                    alert('ERROR\nFile cannot be marked to new IO before receiving from Naib Court' )
                } else if (data == 11) {
                    alert('ERROR\nPlease fill Marked IO name along with the date' )
                } else if (data == 12) {
                    alert('ERROR:\nThe date for current status can\'t be before the date of registration' )
                } else if (data == 13) {
                    alert('ERROR:\nThe date for receiving the FIR from VRK cannot be before it is sent back from there' )
                } else if (data == 14) {
                    alert('ERROR:\nThe date for submitting the FIRin court cannot be before receiving it from VRK' )
                } else if (data == 15) {
                    alert('ERROR:\nThe date for receiving the FIR from Naib Court cannot be before it is sent back from there' )
                } else if (data == 16) {
                    alert('ERROR:\nThe date for marking IO cannot be before the date of receiving the FIR' )
                } else if (data == 17) {
                    alert('ERROR:\nDate of current status cannot be before date of appointing the new IO in previous phase' )
                } else if (data == 18) {
                    alert('ERROR:\nFuture Dates are not permitted')
                }

                // Check if new phase can be added (0 for all data saved and 19 for all data saved along with change in limitation period)
                if (data == 0 || data == 19) {
                    $.ajax({
                        type: 'GET',
                        url: '/firBeta/ajax/all_fields_filled/',
                        data: {
                            phase_pk: fir_phase_pk
                        },
                        success: function (data) {
                            if (data == 0) {
                                $(`#add_${fir_phase_id}`).removeClass('disabled')
                                window.location.href = `/firBeta/add-new-phase/${fir_phase_pk}/`;
                            } else if (data == 1) {
                                $(`#add_${fir_phase_id}`).addClass('disabled')
                            }
                        }
                    })
                }

                // If the previous condition does not match and the value is 19, means the page has to be reloaded as limitation period is changed
                if (data != 0 && data == 19) {
                    window.location.href = '/firBeta/ps';
                }

                $(`#save_${fir_phase_id}`).text("SAVE");
            }
        });
    });

    $('.close-confirmation-modal-btn').click(function () {
        var fir_phase_id = $(this).attr('id').substring(29);
        var fir_phase_pk = $(this).attr('id').substring(39);

        var fir_id = $(this).attr('class').split(' ')[2] // fir_{{fir_set.0.pk}} is the third class allotted to delete ocnfirmation button

        $(this).text("WAIT..");

        $.ajax({
            type: 'POST',
            url: '/firBeta/ajax/edit_fir_save_close_ps/',
            headers: {
                'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
            },
            data: {
                phase_pk: fir_phase_pk,
                under_section: $(`.under_section.${fir_phase_id}`).val(),
                io_name: $(`.io_name.${fir_phase_id}`).val(),
                accused_name: $(`.accused_name.${fir_phase_id}`).val(),
                accused_status: $(`.accused_status.${fir_phase_id}`).val(),
                limitation_period: $(`.limitation_period.${fir_phase_id}`).val(),
                current_status: $(`.current_status.${fir_phase_id}`).val(),
                current_status_date: $(`.current_status_date.${fir_phase_id}`).val(),
                received_from_vrk_date: $(`.received_from_vrk_date.${fir_phase_id}`).val(),
                put_in_court_date: $(`.put_in_court_date.${fir_phase_id}`).val(),
                received_from_nc_date: $(`.received_from_nc_date.${fir_phase_id}`).val(),
                appointed_io: $(`.appointed_io.${fir_phase_id}`).val(),
                appointed_io_date: $(`.appointed_io_date.${fir_phase_id}`).val(),              
            },
            success: function (data) {
                $(`#close-confirmation-modal-btn-${fir_phase_id}`).text("CLOSE FIR")
                if (data == 0) {
                    $(`#save_${fir_phase_id}`).addClass('disabled');
                    $(`#save_close_${fir_phase_id}`).addClass('disabled');
                    $(`#edit_${fir_phase_id}`).removeClass('disabled');
                    $(`.ps-editable-fields.${fir_phase_id}`).attr('disabled','disabled');
                    $('select').formSelect();
                    $(`.data-row.${fir_phase_id}`).removeClass('teal');
                    $(`.data-row.${fir_phase_id}`).removeClass('blue');
                    $(`.data-row.${fir_phase_id}`).addClass('cyan');
                    $(`.right-sticky-column.${fir_phase_id}`).each(function() {
                        $(this).removeClass('teal');
                        $(this).removeClass('blue');
                        $(this).addClass('cyan');
                    })
                    alert('FIR saved and closed successfully!');

                    $(`.data-row.${fir_id}`).each(function() {
                            $(this).hide();
                    })
                    $(`.blank-row.${fir_id}`).each(function() {
                        $(this).hide();
                    })
                } else if (data == 1) {
                    window.location.href = '/fault/Missing%20parameters%20for%registration';
                } else if (data == 2) {
                    window.location.href = '/fault/ACCESS%20DENIED!';
                } else if (data == 3) {
                    window.location.href = '/fault/Invalid%20Operation%20Requested';
                } else if (data == 4) {
                    alert('ERROR\nInvalid parameters passed, kindly recheck.' )
                } else if (data == 5) {
                    alert('ERROR\nMissing essential parameters' )
                } else if (data == 6) {
                    alert('ERROR\nMissing essential parameters' )
                } else if (data == 7) {
                    alert('ERROR\nFile cannot be received until it is returned from SSP Office' )
                } else if (data == 8) {
                    alert('ERROR\nFile cannot be submitted in Court before it is received back from SSP Office' )
                } else if (data == 9) {
                    alert('ERROR\nFile cannot be received until it is returned from Naib Court' )
                } else if (data == 10) {
                    alert('ERROR\nFile cannot be marked to new IO before receiving from Naib Court' )
                } else if (data == 11) {
                    alert('ERROR\nPlease fill Marked IO name along with the date' )
                } else if (data == 12) {
                    alert('ERROR\nStatus must be Challan Filed to Close FIR' )
                } else if (data == 13) {
                    alert('ERROR:\nThe date for current status can\'t be before the date of registration' )
                } else if (data == 14) {
                    alert('ERROR:\nThe date for receiving the FIR from VRK cannot be before it is sent back from there' )
                } else if (data == 15) {
                    alert('ERROR:\nThe date for submitting the FIRin courtcannot be before receiving it from VRK' )
                } else if (data == 16) {
                    alert('ERROR:\nThe date for receiving the FIR from Naib Court cannot be before it is sent back from there' )
                } else if (data == 17) {
                    alert('ERROR:\nThe date for marking IO cannot be before the date of receiving the FIR' )
                } else if (data == 18) {
                    alert('ERROR:\nDate of current status cannot be before date of appointing the new IO in previous phase' )
                } else if (data == 19) {
                    alert('ERROR:\nFuture Dates are not permitted')
                }
            },
            fail: function() {
                $(`#close-confirmation-modal-btn-${fir_phase_id}`).text("CLOSE FIR")
            }
        });
    });

    $('.toggle-btn').click(function() {
        // $('tbody.content-descending').toggle();
        // $('tbody.content-ascending').toggle();
        if ($('.data-table-body').hasClass('content-descending')) {
            window.location.href = '/firBeta/ps/1/';
        } else {
            window.location.href = '/firBeta/ps/';
        }
    })

    $('tr.data-row').click(function() {
        // var row_pk = $(this).attr('class').split(' ')[4];
        var row_pk = $(this).attr('data-tr-fir-phase');

        if(! $(this).hasClass('teal')){
            $('.data-row').each(function() {
                $(this).removeClass('blue');
                $(this).addClass('cyan');
            })
            $(`.right-sticky-column`).each(function() {
                $(this).removeClass('blue');
                $(this).addClass('cyan');
            })

            $(`.data-row.${row_pk}`).removeClass('cyan');
            $(`.data-row.${row_pk}`).addClass('blue');

            $(`.right-sticky-column.${row_pk}`).each(function() {
                $(this).removeClass('cyan');
                $(this).addClass('blue');
            })
        }
    })
</script>
{% endblock tail %}